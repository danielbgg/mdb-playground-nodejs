const { MongoClient } = require("mongodb");
const uri = process.env.ATLAS_URL;
const client = new MongoClient(uri);

async function run() {
  try {

    // Get the database and collection on which to run the operation
    const database = client.db("VECTOR_SEARCH");
    const fashion = database.collection("FASHION");

    //dark green shirt
    const vector_query = [0.7803924083709717, 0.418776273727417, 0.43927353620529175, -0.5427386164665222, 0.23334328830242157, -0.8997673988342285, 0.8056522607803345, 0.39013364911079407, -0.3185782730579376, -0.4767482876777649, 0.06452478468418121, 0.23540854454040527, 0.6079869270324707, 0.09942521899938583, 0.3165714144706726, 0.12420254945755005, 0.26998478174209595, -0.06201803684234619, -1.0739097595214844, 0.15639521181583405, 0.1589566469192505, -0.14152643084526062, 0.2198256105184555, -0.14355865120887756, 0.47122764587402344, -0.6464694142341614, 0.03619077801704407, 0.40730130672454834, 1.134223461151123, -0.12563854455947876, 0.32960745692253113, -0.6304886341094971, -0.09508613497018814, -0.06285275518894196, 0.3670009672641754, 0.6576791405677795, -0.31145691871643066, -1.0565928220748901, 0.4035103917121887, -0.20748364925384521, -0.8733229637145996, -0.3262307643890381, 0.23828941583633423, -0.8275555968284607, -0.7308709025382996, 0.31539401412010193, 0.2952142655849457, 0.46075594425201416, -0.14123646914958954, 0.6563822031021118, 0.30380645394325256, -0.14094531536102295, -0.3863396644592285, -1.0411680936813354, 0.7022520303726196, -0.18993818759918213, -0.5655582547187805, 0.004487268626689911, 0.20356954634189606, -0.670641303062439, -0.22826948761940002, 0.048688746988773346, 0.7311422824859619, 0.20262938737869263, -0.0292242169380188, 0.956975519657135, 0.029516808688640594, -0.43793338537216187, -0.11515235155820847, 0.19824087619781494, 0.4296535849571228, 0.39350786805152893, -0.039991214871406555, 0.196015864610672, 0.25646454095840454, 0.2312830090522766, 0.19468364119529724, -0.07781602442264557, 0.2237933725118637, 0.30992206931114197, -0.594510018825531, -0.5667575001716614, -0.0054634809494018555, -0.06076230853796005, -0.18761317431926727, -0.307496041059494, 0.189766988158226, 0.07991178333759308, -0.6701303720474243, -0.4188884198665619, -0.028976887464523315, 0.09479572623968124, -0.29861682653427124, -0.3936498165130615, -0.4679059386253357, 0.3161667585372925, -0.7997690439224243, 0.31600823998451233, 0.14871352910995483, -0.3288155198097229, 0.4456859827041626, -0.16472840309143066, 0.19392313063144684, 0.2779492735862732, 0.38853275775909424, -0.2665325105190277, 0.21388939023017883, -0.12280946969985962, -0.12267100811004639, -0.13217277824878693, 0.9154750108718872, 0.3097730576992035, -0.5693145990371704, 0.24510565400123596, -0.35284489393234253, 0.05400855839252472, -0.23740331828594208, -0.10153676569461823, -0.4991081953048706, -0.4207412004470825, 0.3796690106391907, -0.4477338194847107, 0.7422729730606079, -0.5813066363334656, 0.8059914112091064, -0.16536620259284973, 0.5025558471679688, 0.29001471400260925, -0.24343279004096985, -0.7201505303382874, 0.6346077919006348, -0.6178889274597168, -0.1703566312789917, -0.24639829993247986, -0.47810161113739014, 0.15972387790679932, -0.053114503622055054, 0.44294100999832153, -0.3737328052520752, -0.1252027153968811, -0.4310820698738098, -0.10302818566560745, -0.012251749634742737, 0.46043699979782104, -0.41529661417007446, 0.8734503984451294, -0.3704516291618347, 0.26403582096099854, -0.476735383272171, -0.1216173768043518, -0.2611750364303589, 0.15574130415916443, 0.3262067437171936, -0.5182985067367554, -0.16372056305408478, -0.5429012179374695, -0.22582155466079712, -0.4409945607185364, -0.29827168583869934, -0.48186784982681274, -0.7501604557037354, 0.10623827576637268, -0.45107781887054443, 0.18345676362514496, 0.18017661571502686, -0.015251725912094116, 0.08840971440076828, -0.15618544816970825, -0.32424062490463257, -0.3982018530368805, 0.11107978224754333, -0.061197564005851746, 0.6904172301292419, 0.004263587296009064, -0.13850541412830353, 0.5688391923904419, 0.09148719906806946, -0.4839310050010681, 0.34714993834495544, 0.01594681292772293, -0.02977100759744644, -0.47258615493774414, -0.43003788590431213, 0.011937931180000305, -0.2878913879394531, 0.23016570508480072, 0.24592700600624084, -0.003523200750350952, 0.46531081199645996, -0.040983766317367554, 0.37489160895347595, -0.35506147146224976, 0.05392981320619583, -0.020328830927610397, 0.2685869038105011, -1.9430458545684814, 0.6524543762207031, -0.08776302635669708, -0.22041793167591095, -0.12624689936637878, 0.543232262134552, 0.9656853675842285, 0.27150747179985046, -0.006656289100646973, -0.7936902046203613, -0.021024812012910843, 0.0013799667358398438, 0.10014380514621735, -0.23399978876113892, 0.44213902950286865, -0.25711262226104736, -0.14680542051792145, -0.09337807446718216, 0.732014000415802, -0.19887489080429077, -0.20240361988544464, -0.5941803455352783, -0.23558922111988068, -0.08076286315917969, 0.06056475639343262, -0.2848189175128937, -0.9218105673789978, -0.09585265070199966, -0.5219093561172485, 0.7051414847373962, -0.10397468507289886, 0.010501384735107422, -0.06421224772930145, 0.21021807193756104, -0.6064448356628418, -0.28698495030403137, 0.47302454710006714, 0.0833188071846962, 0.33292222023010254, -0.15140245854854584, 0.12389782071113586, 0.014871254563331604, -0.4630591869354248, 0.3928737938404083, -0.11771057546138763, 0.15546143054962158, -0.6431463956832886, -0.3368014097213745, 0.3474448025226593, -0.25151821970939636, 0.481509804725647, -0.5110056400299072, 0.01040215790271759, 0.6210221648216248, 0.311988890171051, 0.04918700456619263, -0.9018008708953857, 0.04273134469985962, -0.0315311998128891, -0.6252546310424805, -0.167673721909523, -0.29978108406066895, -0.16842447221279144, 0.46351683139801025, -0.6661657094955444, 0.06650751829147339, -0.2968377470970154, 0.6899429559707642, -0.05895332992076874, 0.02725612372159958, -0.29125136137008667, 0.36501288414001465, -0.0453474223613739, 0.09489097446203232, -0.5554136037826538, 0.01855182647705078, -0.06844942271709442, -0.16748937964439392, -0.15391825139522552, 0.654543399810791, 0.17423929274082184, 0.09349960088729858, 0.10207341611385345, -0.5606909394264221, -0.30459195375442505, -0.023347709327936172, 0.6112898588180542, -0.17807526886463165, 0.1697961688041687, -0.37002524733543396, 0.12526586651802063, 0.10221046209335327, -0.2675955891609192, -1.5954711437225342, -0.4847192168235779, -0.06618514657020569, 0.6099775433540344, -0.22767774760723114, -0.03681565821170807, -0.21284231543540955, 0.38012728095054626, -0.6914912462234497, -0.36710911989212036, -0.11034807562828064, -0.1986943930387497, -0.43608230352401733, 0.002996772527694702, 0.3010839521884918, 0.16583818197250366, -0.1742064654827118, -0.37841475009918213, -0.4430520236492157, 0.11128465831279755, 0.08625161647796631, -0.4472915232181549, 0.09833437204360962, 0.35693109035491943, -0.18946047127246857, -0.31801193952560425, -0.4889988303184509, 0.044765904545784, -5.905923843383789, 0.4373522400856018, 0.17053678631782532, 0.39961060881614685, 0.15921694040298462, 0.13956478238105774, 0.5115616321563721, -0.10086029767990112, 0.060133516788482666, -0.017981208860874176, -0.7228924036026001, -0.712493360042572, 0.12248793244361877, 0.07122595608234406, -0.6446335315704346, -0.33225753903388977, -0.25825655460357666, 0.3856971859931946, 0.2588726282119751, -0.14766615629196167, 0.05660596489906311, -0.08569524437189102, 0.18058770895004272, 0.49547722935676575, -0.37920185923576355, 0.4834724962711334, 0.13940151035785675, 0.051326312124729156, 0.6700552105903625, -0.19774183630943298, 0.3838295340538025, 0.48263677954673767, -0.2846315801143646, 0.45044928789138794, 0.17657586932182312, 0.1373712122440338, 0.10981859266757965, 0.37729793787002563, 0.31015583872795105, -0.13403233885765076, 0.3951703906059265, -0.21323297917842865, 0.14304184913635254, 0.4928295910358429, -0.5516794919967651, -0.4266200661659241, 0.23222872614860535, -0.525263249874115, 0.111605703830719, -0.017898187041282654, -0.11576031148433685, -0.5846552848815918, 0.15520340204238892, 0.25673288106918335, -0.12836655974388123, 0.10110646486282349, 0.30671295523643494, 0.1989399939775467, -0.34907305240631104, 0.15300844609737396, -0.02927219867706299, -0.13759571313858032, -0.2375478744506836, -0.6528606414794922, -0.37674450874328613, 0.2472844272851944, -0.4737849831581116, -0.5755066275596619, -0.545490562915802, -0.09574520587921143, 0.5230428576469421, 0.26118481159210205, -0.16647417843341827, 0.17258159816265106, 0.9075806140899658, -0.5754110813140869, -0.553756594657898, -0.5246442556381226, -0.2777198255062103, 0.48805952072143555, -0.6977028846740723, -0.13608431816101074, 0.024437010288238525, -0.4542616605758667, -0.4385150671005249, -0.19940194487571716, 0.049433350563049316, 0.7258515357971191, 0.0771222710609436, -0.16937440633773804, 0.4105512499809265, -0.3564550280570984, 0.45343220233917236, -0.13955800235271454, -0.2504776120185852, -0.2047819197177887, -0.2604997456073761, -1.0536233186721802, -0.5158019661903381, 0.1184476986527443, -0.5897541642189026, -0.07523836195468903, -0.4780648350715637, 0.3364066481590271, 0.08247244358062744, 0.01824081689119339, 0.3983713686466217, -0.4660494327545166, -0.20120516419410706, -0.7162554264068604, -0.006483450531959534, 0.3886955976486206, 0.4446624517440796, 0.4520445764064789, -0.3663214445114136, -0.09426285326480865, -0.2957102656364441, 0.8101876378059387, 0.25589919090270996, -0.12991955876350403, 0.35267430543899536, -0.0232771635055542, 0.1381700336933136, -0.04163210839033127, 5.219193458557129, 0.5323898196220398, 0.28337612748146057, 0.45858702063560486, 0.31917470693588257, 0.3005684018135071, 0.06810393929481506, 0.11922572553157806, -0.08124727010726929, 0.4947574734687805, -0.19008119404315948, -0.7403794527053833, 0.5825502276420593, -0.140085369348526, 0.44174307584762573, 0.17524155974388123, -0.3682309687137604, 0.17756134271621704, -0.24110069870948792, 0.6833522915840149, 0.5668925642967224, 0.010102242231369019, -0.9787814021110535, 0.30218473076820374, -0.18463481962680817, 0.11141616106033325, 0.07868336141109467, -0.09019535779953003, 0.6568465232849121, 0.29780203104019165, -0.10463784635066986, 0.22988629341125488, 0.6415207386016846, 0.6139878630638123, -0.11894471943378448, -0.16695807874202728, -0.22220772504806519, -0.8921808004379272, 0.47865256667137146, 0.14142321050167084, -0.05701753497123718, 0.6134876608848572, -0.3263515532016754, 0.2118898630142212, 0.16019369661808014, 0.22961854934692383, 0.3692472577095032, -0.010774031281471252, 0.5725459456443787, -0.017515316605567932, 0.065544992685318, 0.5432417392730713, -0.5749840140342712, 1.0839177370071411, 0.2735618054866791, 0.41771918535232544, 0.4966541528701782, 0.013368185609579086, -0.4106125235557556, -0.6280875205993652, -0.23228693008422852, -0.07124599814414978, -0.34686005115509033, -0.1385921835899353, -0.6885039806365967, -0.48604315519332886, -0.4089902937412262, 0.15520340204238892, 0.41343772411346436, -0.2952269911766052, -0.08381851017475128, 0.011162713170051575, -0.46874213218688965, -0.1303921490907669, -0.5711983442306519, -0.1801101118326187, 0.2883857488632202, -0.03754345327615738, -0.49642878770828247, -0.06621387600898743, 0.11856141686439514, 0.6912221312522888, 0.008318856358528137, 0.2725558876991272, 0.3293095529079437, -0.172878235578537, -0.33014339208602905, 0.36370086669921875, -0.1573411226272583, 0.1518690437078476, 0.42927777767181396, -0.5606818199157715, -0.13789236545562744, 0.05004134774208069, 0.19771859049797058, -0.6987988352775574, 0.22883011400699615, 0.30998361110687256, 0.28328725695610046, -0.8963427543640137, -0.4513605833053589, 0.3289690613746643, -0.04417791962623596, 0.20044828951358795, -0.056399114429950714, 0.06661193072795868, 0.15164747834205627, -0.03060682862997055, 0.5934817790985107, -0.3762432038784027, 0.26831597089767456, 0.021487966179847717, -0.03331752121448517, -0.3682195544242859, 0.6856371164321899, -0.1647937297821045, 0.14391949772834778, 0.36817482113838196, -0.2949311137199402, -0.5161075592041016, 0.19824835658073425, -0.38963785767555237, -0.7455084323883057, 0.4849347472190857, 0.12131908535957336, -0.007091090083122253, 0.14589016139507294, 0.509516716003418, 0.33749425411224365, -0.27054375410079956, 0.03551088273525238, 0.16522204875946045, -1.1614277362823486, -0.19396691024303436, -0.2163076251745224, 0.3576776683330536, 0.1534227728843689, 0.13422945141792297, -0.11183849722146988, -0.04329301416873932, -0.04456377774477005, 0.4751572608947754, -0.42537856101989746, -0.3069021701812744, -0.7129265069961548, 0.4895099401473999, 0.30017539858818054, 0.3141157329082489, -0.08902771770954132, -0.19734671711921692, -0.18309779465198517, -0.07645422220230103, 1.0219002962112427, -0.1404770314693451, 0.2648102939128876, 0.20730315148830414, 0.4568570852279663, 0.27535343170166016, -0.08355651795864105, -0.6487100124359131, 0.421385794878006, -0.04664182662963867, 0.13681350648403168, -0.6059824228286743, -0.18654116988182068, -0.5608257055282593, 0.08888445049524307, 0.16092045605182648, 0.17594651877880096, -0.25793537497520447, -0.14452645182609558, 0.612015426158905, 0.2868415117263794, -0.22436153888702393, -0.2875613272190094, -0.21959246695041656, -0.797785758972168, -0.4972262680530548, 0.23956406116485596, 0.7487772703170776, 0.21161523461341858, 0.11449053883552551, -0.4696623682975769, 0.3906900882720947, -0.3933458924293518, 0.5011789798736572, -0.2021956443786621, 0.32098153233528137, -0.09872829914093018, -0.062225133180618286, 0.35589396953582764, 0.16047096252441406, -0.03966210037469864, -0.15176674723625183, -0.20849424600601196, -0.35644564032554626, 0.32109779119491577, -0.03985823690891266, 0.1677265167236328, 0.46736857295036316, 0.5173687934875488, -0.16251838207244873, 0.07401205599308014, -0.7045458555221558, 1.0635607242584229, -0.09206601232290268, -0.10430409014225006, 0.4092194437980652, -0.7579125165939331, 0.20733079314231873, -0.27478355169296265, -0.21793457865715027, 0.12940630316734314, -0.17539024353027344, 1.5893173217773438, 0.5421786308288574, 0.7951996326446533, -0.20114484429359436, -0.3049328625202179, 0.38936349749565125, -0.1648838222026825, 0.1618930846452713, 0.1639537364244461, 0.5222452282905579, 0.26431000232696533, -0.5520712733268738, 0.18373802304267883, 0.06872278451919556, 0.3542442321777344, 0.15184718370437622, -0.14068841934204102, -0.39106619358062744, -0.11627838015556335, 0.20214009284973145, -0.1351340264081955, -0.607336163520813, -0.014275670051574707, -0.3604277968406677, -0.3888448476791382, -0.2604445815086365, -0.396675705909729, -0.06690161675214767, -0.5897044539451599, -0.22884587943553925, 0.28595519065856934, -0.28345638513565063, -0.2550585865974426, 0.35534268617630005, 0.17096738517284393, -0.16020995378494263, -0.22888320684432983, 0.24396347999572754, 0.16533610224723816, 0.4216625690460205, 0.42813408374786377, 0.2173032909631729, 0.03701294958591461, 0.42752936482429504, 0.4326801598072052, -0.11362338066101074, 0.28393977880477905, 0.15007856488227844, 0.030921459197998047, -1.0512491464614868, 0.3092505633831024, 0.09882378578186035, 0.2486145943403244, 0.2654649615287781, 0.10154952108860016, 0.19414299726486206, -0.03114229440689087, 0.043583571910858154, -0.40464144945144653, -0.4961409568786621, -0.20937058329582214, -0.30336999893188477, 0.5036770701408386, -0.5942959189414978, 0.08739887177944183, -0.5129393339157104, -0.31327569484710693, -0.4973282516002655, -0.2612910270690918, -0.0016829967498779297, 0.3647400140762329, 0.2738659977912903, 0.26269975304603577, -0.0731915682554245, 0.5419888496398926, 0.24489739537239075, -0.018569856882095337, -0.4532988667488098, 0.9877907037734985, -0.4569544792175293, 0.6482381820678711, -0.20826974511146545, 0.01179620623588562, 0.31133851408958435, 0.11214599013328552, -0.46909433603286743, 0.2737191319465637, 0.06670385599136353, 0.16258463263511658, 0.18747389316558838, 0.0692611038684845, 0.9646270275115967, -0.03234312683343887, -0.5630579590797424, 0.24253630638122559, 0.014361947774887085, -0.6572774648666382, 0.11979249119758606, -0.04855534806847572, 0.6229493021965027, -0.24864429235458374, -0.9145292043685913, 0.09056618809700012, 0.07560999691486359, -0.3179722726345062, -0.2951008081436157, -0.32431843876838684, -0.007730945944786072, -0.2572343647480011, -0.5992802381515503, -0.04974108934402466, -0.7231542468070984, 0.2428685873746872, -0.6413940191268921];

    const pipeline = [];

    pipeline.push({
      "$vectorSearch": {
        "index": "default",
        "path": "imageVector",
        "queryVector": vector_query,
        "numCandidates": 100,
        "limit": 10
      }
    });

    pipeline.push({
      "$project": {
        "imageVector": { "$slice": ["$imageVector", 5] },
        "imageFile": 1,
        "price": 1,
        "discountPercentage": 1,
        "averageRating": 1,
        "_id": 0,
        'score': {
          '$meta': 'vectorSearchScore'
        }
      }
    });

    const aggregationResult = await fashion.aggregate(pipeline);

    for await (const document of aggregationResult) {
      console.log(document);
    }

  } finally {
    await client.close();
  }
}
run().catch(console.dir);
